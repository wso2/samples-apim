"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.toAPISchema = void 0;
const graphql_1 = require("graphql");
const buildComposedSchema_1 = require("./buildComposedSchema");
const removeInaccessibleElements_1 = require("./removeInaccessibleElements");
function toAPISchema(schema) {
    if (schema.__apiSchema) {
        return schema.__apiSchema;
    }
    graphql_1.assertValidSchema(schema);
    schema = removeInaccessibleElements_1.removeInaccessibleElements(schema);
    const featureNames = buildComposedSchema_1.supportedFeatures.map((feature) => feature.name);
    const schemaConfig = schema.toConfig();
    const apiSchema = new graphql_1.GraphQLSchema({
        ...schemaConfig,
        types: schemaConfig.types.filter(isExported),
        directives: schemaConfig.directives.filter(isExported),
    });
    graphql_1.assertValidSchema(apiSchema);
    schema.__apiSchema = apiSchema;
    return apiSchema;
    function isExported(element) {
        for (const featureName of featureNames) {
            if (isAssociatedWithFeature(element, featureName)) {
                return false;
            }
        }
        return true;
    }
}
exports.toAPISchema = toAPISchema;
function isAssociatedWithFeature(element, featureName) {
    return ((graphql_1.isDirective(element) && element.name === featureName) ||
        element.name.startsWith(`${featureName}__`));
}
//# sourceMappingURL=toAPISchema.js.map